{% extends "base.html" %}
{% block title %}Inbox â€“ Archi Input{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Inbox</h1>
    <p class="page-subtitle">ä½œå“åã‚„URLã‚’è¿½åŠ ã—ã¦ã€å»ºç¯‰äº‹ä¾‹ã‚’ã‚¹ãƒˆãƒƒã‚¯ã—ã‚ˆã†</p>
</div>

{% if request.args.get('error') %}
<div class="alert alert-error">
    <span class="alert-icon">âš </span>
    {{ request.args.get('error') }}
</div>
{% endif %}

{% if request.args.get('success') %}
<div class="alert alert-success">
    <span class="alert-icon">âœ“</span>
    è¿½åŠ ã—ã¾ã—ãŸï¼
    {% if request.args.get('analyzing') %}
    <span class="analyzing-indicator" id="auto-analyze-status" data-id="{{ request.args.get('analyzing') }}">
        <span class="spinner"></span> AIåˆ†æä¸­â€¦
    </span>
    {% endif %}
</div>
{% endif %}

<form action="{{ url_for('add_work') }}" method="POST" enctype="multipart/form-data" class="inbox-form">
    <div class="form-group">
        <label for="title">ä½œå“å</label>
        <input type="text" id="title" name="title" placeholder="ä¾‹ï¼šå…‰ã®æ•™ä¼š" class="form-input" autocomplete="off">
    </div>
    <div class="form-group">
        <label for="url">URL</label>
        <input type="url" id="url" name="url" placeholder="https://..." class="form-input" autocomplete="off">
    </div>
    <div class="form-group">
        <label for="image">ğŸ“· å»ºç¯‰å†™çœŸï¼ˆä»»æ„ï¼‰</label>
        <div class="file-upload-wrapper">
            <input type="file" id="image" name="image" accept="image/*" class="file-input"
                onchange="previewImage(this)">
            <div class="file-upload-label" id="file-label">
                <span class="file-upload-icon">ğŸ“</span>
                <span>ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ã§ç”»åƒã‚’é¸æŠ</span>
                <span class="file-upload-hint">PNG, JPG, WEBPï¼ˆ16MBã¾ã§ï¼‰</span>
            </div>
        </div>
        <div id="image-preview" class="image-preview" style="display:none;">
            <img id="preview-img" src="" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
            <button type="button" class="btn btn-danger btn-sm" onclick="clearImage()">âœ• å‰Šé™¤</button>
        </div>
    </div>
    <button type="submit" class="btn btn-primary">
        <span class="btn-icon">+</span>
        è¿½åŠ 
    </button>
</form>

{% if recent %}
<div class="recent-section">
    <h2 class="section-title">æœ€è¿‘ã®è¿½åŠ </h2>
    <div class="recent-list">
        {% for work in recent %}
        <div class="recent-item" id="recent-{{ work.id }}">
            <div class="recent-item-info">
                <div class="recent-item-top">
                    <span class="recent-title">{{ work.title or '(ç„¡é¡Œ)' }}</span>
                    {% if work.is_analyzed %}
                    <span class="badge badge-analyzed">åˆ†ææ¸ˆ</span>
                    {% endif %}
                </div>
                {% if work.url %}
                <a href="{{ work.url }}" target="_blank" rel="noopener" class="recent-url">{{ work.url[:60] }}{% if
                    work.url|length > 60 %}â€¦{% endif %}</a>
                {% endif %}
                {% if work.is_analyzed and work.architect %}
                <span class="recent-meta">{{ work.architect }}{% if work.year %} Â· {{ work.year }}{% endif %}{% if
                    work.country %} Â· {{ work.country }}{% endif %}</span>
                {% endif %}
            </div>
            <div class="recent-item-actions">
                {% if not work.is_analyzed %}
                <button class="btn btn-ai btn-sm" onclick="analyzeWork({{ work.id }}, this)" title="AIåˆ†æ">
                    ğŸ¤– åˆ†æ
                </button>
                {% endif %}
                <span class="recent-date">{{ work.created_at.strftime('%m/%d %H:%M') if work.created_at else ''
                    }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}