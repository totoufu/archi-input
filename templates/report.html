{% extends "base.html" %}
{% block title %}Report â€“ Archi Input{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Report</h1>
    <p class="page-subtitle">å»ºç¯‰äº‹ä¾‹ã®åã‚Šåˆ†æã¨AIãƒ¬ãƒãƒ¼ãƒˆ</p>
</div>

<!-- Stats Overview -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total }}</div>
        <div class="stat-label">ç·ç™»éŒ²æ•°</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ analyzed }}</div>
        <div class="stat-label">AIåˆ†ææ¸ˆ</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total - analyzed }}</div>
        <div class="stat-label">æœªåˆ†æ</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ countries|length }}</div>
        <div class="stat-label">ã‚«ãƒãƒ¼å›½æ•°</div>
    </div>
</div>

{% if analyzed > 0 %}
<!-- Distribution Charts -->
<div class="charts-section">
    <div class="chart-card">
        <h3 class="chart-title">ğŸŒ å›½åˆ¥åˆ†å¸ƒ</h3>
        <div class="chart-bars">
            {% for country, count in countries.items() %}
            <div class="chart-row">
                <span class="chart-label">{{ country }}</span>
                <div class="chart-bar-wrapper">
                    <div class="chart-bar bar-country" style="width: {{ (count / total * 100)|round }}%"></div>
                </div>
                <span class="chart-value">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chart-card">
        <h3 class="chart-title">ğŸ¢ ç”¨é€”åˆ¥åˆ†å¸ƒ</h3>
        <div class="chart-bars">
            {% for usage, count in usages.items() %}
            <div class="chart-row">
                <span class="chart-label">{{ usage }}</span>
                <div class="chart-bar-wrapper">
                    <div class="chart-bar bar-usage" style="width: {{ (count / total * 100)|round }}%"></div>
                </div>
                <span class="chart-value">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chart-card">
        <h3 class="chart-title">ğŸ”© æ§‹é€ åˆ¥åˆ†å¸ƒ</h3>
        <div class="chart-bars">
            {% for struct, count in structures.items() %}
            <div class="chart-row">
                <span class="chart-label">{{ struct }}</span>
                <div class="chart-bar-wrapper">
                    <div class="chart-bar bar-structure" style="width: {{ (count / total * 100)|round }}%"></div>
                </div>
                <span class="chart-value">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chart-card">
        <h3 class="chart-title">ğŸ“… å¹´ä»£åˆ¥åˆ†å¸ƒ</h3>
        <div class="chart-bars">
            {% for decade, count in decades.items() %}
            <div class="chart-row">
                <span class="chart-label">{{ decade }}s</span>
                <div class="chart-bar-wrapper">
                    <div class="chart-bar bar-decade" style="width: {{ (count / total * 100)|round }}%"></div>
                </div>
                <span class="chart-value">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- AI Report Generation -->
<div class="report-section">
    <h2 class="section-title">ğŸ¤– AIãƒ¬ãƒãƒ¼ãƒˆ</h2>
    <p class="report-description">Gemini AIãŒã‚ãªãŸã®å»ºç¯‰ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚’åˆ†æã—ã€åã‚Šã‚„ãŠã™ã™ã‚ã‚’ææ¡ˆã—ã¾ã™</p>
    <div class="form-group">
        <label for="report-prompt">åˆ†æã®æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰</label>
        <textarea id="report-prompt" class="form-input report-prompt-input"
            placeholder="ä¾‹ï¼š&#10;ãƒ»æ§‹é€ ã®è¦³ç‚¹ã‹ã‚‰æ¯”è¼ƒåˆ†æã—ã¦ã»ã—ã„&#10;ãƒ»ã‚³ãƒ«ãƒ“ãƒ¥ã‚¸ã‚¨ã®ä½œå“ã‚’ä¸­å¿ƒã«è€ƒå¯Ÿã—ã¦&#10;ãƒ»å…¬å…±å»ºç¯‰ã®ã‚ã‚Šæ–¹ã«ã¤ã„ã¦è«–ã˜ã¦&#10;ãƒ»ç©ºæ¬„ãªã‚‰æ¨™æº–ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™"
            rows="3"></textarea>
    </div>
    <button class="btn btn-primary btn-lg" id="generate-report-btn" onclick="generateReport()">
        ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹
    </button>
    <div id="report-output" class="report-output" style="display:none;"></div>
</div>

{% else %}
<div class="empty-state">
    <div class="empty-icon">ğŸ“Š</div>
    <p>AIåˆ†ææ¸ˆã¿ã®ä½œå“ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
    <p style="color: var(--text-muted); font-size: 0.85rem;">Libraryã¾ãŸã¯Inboxã‹ã‚‰ä½œå“ã‚’ã€ŒğŸ¤– åˆ†æã€ã—ã¦ã¿ã¦ãã ã•ã„</p>
</div>
{% endif %}
{% endblock %}